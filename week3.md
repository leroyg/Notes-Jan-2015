# Week 3

# Objectives

1. [Resources](#resources)
- [RESTful APIs](#restful-apis)
- [Routing](#routing)
- [Script Loaders](#script-loaders)
- [Polyfills](#polyfills)
- [Caching](#caching)
- [More on Inheritance](#more-on-inheritance)

---

# Discussion Topics and Homework

### (1.) Monday

**Homework**

1. TBD

### (2.) Tuesday

**Homework**

1. TBD

### (2.) Wednesday

**Homework**

1. TBD

### (2.) Thursday

**Homework**

- TBD

---

# Resources

- http://onepagelove.com/
- http://sass-lang.com/guide
- https://www.npmjs.org/
- https://github.com/jonathanpath/SASS-SMACSS
- http://bonsaiden.github.io/JavaScript-Garden/
- http://devdocs.io/
- Mozilla Developer Network: https://developer.mozilla.org/en-US/
- http://blog.keithcirkel.co.uk/how-to-use-npm-as-a-build-tool/
- https://developer.mozilla.org/en-US/docs/Web/Reference/API
- https://developer.mozilla.org/en-US/docs/Web/JavaScript
- https://leanpub.com/understandinges6/read/
- http://blog.andyet.com/2014/08/13/opinionated-rundown-of-js-frameworks
- https://github.com/PROSPricing/js-assessment/tree/master/app
- https://github.com/enaqx/awesome-react
- http://backbonejs.org
- https://github.com/instanceofpro/awesome-backbone
- https://github.com/h5bp/Front-end-Developer-Interview-Questions/blob/master/README.md
- http://youmightnotneedjquery.com/
- https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills
- http://caniuse.com/

---

# RESTful APIs

### In simplest terms: What is a database?

It's a spreadsheet.

### What are RESTful API's?

First, a long description: http://stackoverflow.com/questions/671118/what-exactly-is-restful-programming/671132#671132

Now, let's **distill** ths a bit.

For the Github API, there are various **resources**: `users`, `repos`, `teams`, `notifications`, `feeds`, `emojis`, and so forth. These resources are noted mainly here: https://api.github.com/

A resource, like a `person`, is identifiable by a unique attribute. For a `person`, the unique identifier is a `username`, because no one else should also have that `username`. For a `repo`, it is a large number called an `id`.

That unique identifier, like a `username`, is how we interact with a particular instance of `resource`.

When we interact with databases through a RESTful API, we are given a couple options to interact with resources:

1. `GET` the information record of a particular resource
2. `GET` a collection of records for a group of resources
3. `POST` a new JSON object to the server to create a new record of a resource (i.e. a new `person`)
4. `PUT` an updated version of a record on the server, such as update a `person`'s name
5. `DELETE` a record from a resource collection (such as remove a `person` from the database)

These actions (`GET`, `PUT`, `POST`, `DELETE`) are called HTTP verbs, and are accompanied by equivalent jQuery methods `$.get()`, `$.post()`, and `$.ajax()`.

Simply put, RESTful API's exist because it means there is a standardized way for front-end and back-end (browser and server-side code) to talk to each other.

> example RESTful API interaction

![](./examples/day20/1.png)

### JSONP vs JSON

JavaScript in the browser is subject to more security controls. I mentioned that we used Github API because it is CORS-compatible (Cross Origin Resource Sharing), meaning Github lets other sites access it via JavaScript.

Etsy, however, is **not** CORS-compatible. They require us to use JSONP (which is built-in to jQuery. Yay!). JSONP is a JavaScript file generated by the server with data put into it.

Compare these two URLs and what they return (open them in your browser):

1. https://openapi.etsy.com/v2/listings/183182778?api_key=aavnvygu0h5r52qes74x9zvo
2. https://openapi.etsy.com/v2/listings/183182778.js?api_key=aavnvygu0h5r52qes74x9zvo&callback=test

The first one just returns JSON data, the second one returns a js file with a function `test` being called with a large JS object as the argument.

To use JSONP, we need to change the URL to include two things:

1. The URL should point to a '.js' file
2. The URL passed in to `$.get()` should have `&callback=?` at the end.

**Example:**

```js
var api_key = "aavnvygu0h5r52qes74x9zvo";

var etsy_url = [
    "https://openapi.etsy.com/",
    "v2/",
    "listings/",
    "active.js", // <--- added '.js' to the end here, because Etsy provides JSONP this way
    "?",
    "api_key=",
    api_key,
    "&callback=?" // <--- told jQuery to handle the request as JSONP
].join('');

$.getJSON(etsy_url).then(function(data){
    console.log(data);
});
```

### Etsy's REST API and how to use it:

1. Create an app with Etsy here: https://www.etsy.com/developers/documentation/getting_started/register. This will give you an API key to use. Some services use API keys to provide authorization and to rate-limit people who make too many requests (i.e. spam thousands of requests per second).
2. Get your API key from here: https://www.etsy.com/developers/your-apps
3. API's are released with documentation (how to GET/PUT/POST/DELETE them). One resource on Etsy is called a `listing`, and we can learn how to `GET listings` from https://www.etsy.com/developers/documentation/reference/listing
4. Test the REST API resources with your own API key:
    - get all active listings: https://openapi.etsy.com/v2/listings/active?api_key=aavnvygu0h5r52qes74x9zvo
    - look at an individual product on the API: https://openapi.etsy.com/v2/listings/114711047?api_key=aavnvygu0h5r52qes74x9zvo
    - that product has a `user_id` that we can use to find the user's details on the Etsy API: https://openapi.etsy.com/v2/users/19181170?api_key=aavnvygu0h5r52qes74x9zvo
5. Write some code
    ```js
    var api_key = "aavnvygu0h5r52qes74x9zvo";

    var etsy_url = [
        "https://openapi.etsy.com/",
        "v2/",
        "listings/",
        "active.js",
        "?",
        "api_key=",
        api_key,
        "&callback=?"
    ].join();

    $.getJSON(etsy_url).then(function(data){
        console.log(data);
    });
    ```

# Routing

**Routing, Path.js, wikipedia and :target, JS functions based on the URL, deeplinking**

> Check out this StackOverflow link on Hipchat: http://stackoverflow.com/questions/10075507/what-does-javascript-routing-buy-you

When you go to Gmail and load:
- The _chats_ tab, the URL changes to `https://mail.google.com/mail/u/0/#chats`.
- The inbox is `https://mail.google.com/mail/u/0/#inbox`.
- The spam folder is `https://mail.google.com/mail/u/0/#spam`.

Whenever you click a link that has a URL like:
```html
<a href="#target"></a>
```

The browser interprets a tap/click on this link as "scroll the element with the target id into view". If that target id doesn't exist, the browser will scroll to the top.

No matter what, you will see "#target" be appended to the end of the browser's live URL, and after clicking on multiple target links, you can actually hit the browser's Back and Forward buttons to navigate back and forth along the same page.

We as JavaScript developers can build Single Page App routing experiences on-top of this :-)

In simplest form, we will be doing:

```js
window.addEventListener('hashchange', callbackFunction);
```

However, we will be using a library called Path.js (git://github.com/mtrpcic/pathjs.git), which is installable via bower:
```sh
bower install pathjs
```

Example code for the Etsy site:
```js
EtsyClient.prototype.setupRouting = function(){
    var self = this;

    Path.map("#/").to(function() {
        self.showListings();
    });

    Path.map("#/listing/:id").to(function() {
        console.log(this);
        self.showListing(this.params.id);
    });

    // set the default hash
    Path.root("#/");
    Path.listen();
}
```

# Script Loaders

We uncovered something interesting when working with `$.get()`: we can load any file type, not just JSON. We learned to load template files, or anything accessible via a URL.

We already know one method of putting scripts onto a  website:

```html
<script type="text/javascript" src="..."></script>
```

One popular method of loading JavaScript files into the DOM (the live website) is to do so via JavaScript. This is doable in two ways:
1. The JS will create a script element on the page with `document.createElement('script')` and set its `src` attribute, or
2. The JS will download the text of a JS file via AJAX and when that is done, create a script element and set its `textContent` to that of the AJAX result

These last two methods of "loading JavaScript with JavaScript" are used on sites when:
1. We want to load only a certain script file at a certain time, such as when one area of the page is scrolled into view.
2. We want to load a certain polyfill if the browser doesn't have a certain functionality supported

Number 2 here is a major one - polyfills. It's been mentioned a couple of times now that `Array.prototype.map` doesn't exist in browsers older then IE9. Well, it just so happens that we can test for this, and then load a polyfill (a piece of code that enables a newer feature in an older browser) all in JavaScript:

```js
if(!Array.prototype.map){
    loader.load({url:"./js/url-to-ES5-polyfill.js"}).then(function(){
        // do something when it is done?
    })
}
```

The script-loader used here is something Matt built, simply named Loader (https://github.com/matthiasak/Loader), but there are many script loaders out there. The most popular is called require.js (http://requirejs.org/).

All are, again, installable via bower:

```sh
bower install Loader
```

## Using Loader is easy.

Load one file.
```js
loader.load(
    {url:"..."}
).then(function(){
    // do something when it is done?
})
```

Load three files.
```js
loader.load(
    {url:"..."},
    {url:"..."},
    {url:"..."}
).then(function(){
    // do something when it is done?
})
```

# Polyfills

- Finding polyfills is so easy: https://github.com/Modernizr/Modernizr/wiki/HTML5-Cross-Browser-Polyfills
- Finding if your browser supports something is so easy: http://caniuse.com/

# Caching

**Caching network requests with `$.get()`**

Caching is a term used in networking and computing when a a result can be reused.

For instance, if I compute the sum of ten numbers from by passing those ten numbers to `sumAll()`, I could save that result somewhere and return the same result if the same arguments are ever given again later:

Well, we can **cache** any data requested with `$.get()` as well:

```js
EtsyClient.prototype.loadTemplate = function(name){
    if(!this.templates){
        this.templates = {};
    }

    var self = this;

    if(this.templates[name]){
        var promise = $.Deferred();
        promise.resolve(this.templates[name]);
        return promise;
    } else {
        return $.get('./templates/'+name+'.html').then(function(data){
            self.templates[name] = data; // <-- cache it for any subsequent requests to this template
            return data;
        });
    }
}
```

Using `EtsyClient.prototype.loadTemplate()` in this fashion will make a brand new request the first time, and then send back a cached result every call thereafter.

# More on Inheritance

We have covered Prototypes and Constructors:

```js
function Cat(name){
    this.name = name;
}
Cat.prototype.speak = function(){
    console.log('meow! My name is '+this.name);
}
```

One thing we noted was that any new function that we declare (like `Cat()`) automatically has a prototype chain with the `Object()` function as the highest entity on that prototype chain. In other words, any method on `Object()`'s prototype is available for `Cat()` to use.

### Inheritance and Pokémon

Yes. I'm going to make a mother-effing Pokémon reference. Deal with it. :-)

![](./examples/day22/pikachu.gif)

Imagine our understanding (I hope) of Pokémon:
- All Pokémon can `evolve()`.
- All Pokémon start as the lowest "level" on the food chain, and evolve as they conquer.

Let's model this in JavaScript :-)
```js
function Pokemon(level, levels){
    this.level = level || 0;
    this.levels = levels;
}
Pokemon.prototype.evolve = function(){
    var old_level = this.level;
    this.level = Math.min(this.level+1, this.levels.length-1);
    if(old_level !== this.level){
        console.log(this.levels[old_level]+" evolves into "+this.levels[this.level]+"!");
    } else {
        console.log(this.levels[old_level]+" is at the top of the food chain!");
    }
}

function Pikachu(){
    Pokemon.call(this, 0, ["Pikachu", "Raichu"]);
}
Pikachu.prototype = new Pokemon();
Pikachu.prototype.constructor = Pikachu;

// later, when using it

var myPikachu = new Pikachu();
myPikachu.level; // 0
myPikachu.evolve(); // "Pikachu evolves into Raichu!"
myPikachu.evolve(); // "Raichu is at the top of the food chain!"
```